<template>
  <NavigationBar/>
  <PatternCenter title="使用frp搭建个人办公网络"/>
  <div class="article-container">
    <article>
      <header></header>
      <div class="entry-content-box">
        <div class="entry-content"> <!--v-html="article.content"-->
          <main class="site-main">
            <article>
              <div class="entry-content">
                <p>LCA（最近公共祖先）一般有三种算法解决这类问题。为什么要求树上结点的公共祖先？这是由于求解树上两点间最近距离、以及做树上差分等问题时需要。（其它得做题才知道）</p>
                <h2 id="%E5%90%91%E4%B8%8A%E6%A0%87%E8%AE%B0%E6%B3%95">向上标记法</h2>
                <p>这是最容易理解的一种做法，时间复杂度<span class="katex math inline">O(n)</span>，在多次查询时就不够用了，所以很少用。思想就是从要查询的点向上标记直到根节点，再从另一点出发向上标记，直到标记重合，那个点就是LCA。</p>
                <h2 id="%E5%80%8D%E5%A2%9ELCA%EF%BC%88%E5%9C%A8%E7%BA%BF%EF%BC%89">倍增LCA（在线）</h2>
                <p>使用ST表的倍增思想和dp（ST表本来就是dp）优化向上跳的速度，时间复杂度预处理<span class="katex math inline">O(nlogn)</span>+查询<span class="katex math inline">O(logn)</span>。<br>
                  先用一次bfs（不用dfs因为递归容易爆栈）预处理所有结点向上跳2^k的父亲结点是谁（使用dp）。<br>
                  然后使用LCA算法，不妨设a结点更深，先将a结点向上跳到和b一样高，此时如果a与b是同一个结点则这个点就是LCA，否则他们就是同一深度不同的两点。<br>
                  此时再让他们一起向上跳，加上约束条件：他们向上跳的父节点不同。因为第一个出现父节点相同的可能只是公共祖先而不是最近公共祖先，那么只要父节点不同就是还没跳到LCA。循环结束后保证俩个结点的父节点就是LCA。<br>
                  为什么能确保循环结束后父节点是LCA？因为满足条件时，两个点一起向上跳2^k。众所周知，任何一个十进制正数都能被表示为数个2^k的和。（十进制的二进制表示）那么，如果跳过根节点了，那么他们的父节点都为0不满足约束条件，不跳；如果跳过LCA了，他们的父节点必是一个点（因为经过LCA后，必定跳的位置在同一条子链上）；因此满足约束条件，必定是在LCA下方。此时使用二进制拼凑，得到两个结点的深度与LCA深度的差就是找到了。同时不直接跳到LCA也是由于这个约束条件的关系，更根本的原因其实是约束条件是判断LCA把两个子树合并在一起的性质是否满足（我是这么认为的）。</p>
                <pre class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" design="by Mashiro"><code class="language-cpp hljs" data-rel="CPP" id="code-block-0"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-type">const</span> <span class="hljs-type">int</span> maxn=<span class="hljs-number">4e4</span>+<span class="hljs-number">10</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-type">int</span> dep[maxn],fa[maxn][<span class="hljs-number">20</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-type">int</span> head[maxn],tot;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">    <span class="hljs-type">int</span> to,next;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">}eg[maxn&lt;&lt;<span class="hljs-number">1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">    eg[tot].to=v;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">    eg[tot].next=head[u];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16">    head[u]=tot++;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bfs</span><span class="hljs-params">(<span class="hljs-type">int</span> s)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">    <span class="hljs-built_in">memset</span>(dep,<span class="hljs-number">0x3f</span>,<span class="hljs-keyword">sizeof</span> dep);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">    dep[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>,dep[s]=<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">    queue&lt;<span class="hljs-type">int</span>&gt;q;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">    q.<span class="hljs-built_in">push</span>(s);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">    <span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>())</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">        <span class="hljs-type">int</span> t=q.<span class="hljs-built_in">front</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27">        q.<span class="hljs-built_in">pop</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[t];~i;i=eg[i].next)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29">        {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">            <span class="hljs-type">int</span> j=eg[i].to;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">            <span class="hljs-keyword">if</span>(dep[j]&gt;dep[t]+<span class="hljs-number">1</span>){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32">                dep[j]=dep[t]+<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33">                q.<span class="hljs-built_in">push</span>(j);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34">                fa[j][<span class="hljs-number">0</span>]=t;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35">                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>;k&lt;=<span class="hljs-number">15</span>;k++)fa[j][k]=fa[fa[j][k<span class="hljs-number">-1</span>]][k<span class="hljs-number">-1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36">            }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="37"><div class="hljs-ln-n" data-line-number="37"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="37">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="38"><div class="hljs-ln-n" data-line-number="38"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="38">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="39"><div class="hljs-ln-n" data-line-number="39"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="39">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="40"><div class="hljs-ln-n" data-line-number="40"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="40"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lca</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="41"><div class="hljs-ln-n" data-line-number="41"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="41">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="42"><div class="hljs-ln-n" data-line-number="42"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="42">    <span class="hljs-keyword">if</span> (dep[a] &lt; dep[b]) <span class="hljs-built_in">swap</span>(a, b);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="43"><div class="hljs-ln-n" data-line-number="43"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="43">    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">15</span>; k &gt;= <span class="hljs-number">0</span>; k -- )</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="44"><div class="hljs-ln-n" data-line-number="44"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="44">        <span class="hljs-keyword">if</span> (dep[fa[a][k]] &gt;= dep[b])</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="45"><div class="hljs-ln-n" data-line-number="45"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="45">            a = fa[a][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="46"><div class="hljs-ln-n" data-line-number="46"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="46">    <span class="hljs-keyword">if</span> (a == b) <span class="hljs-keyword">return</span> a;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="47"><div class="hljs-ln-n" data-line-number="47"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="47">    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">15</span>; k &gt;= <span class="hljs-number">0</span>; k -- )</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="48"><div class="hljs-ln-n" data-line-number="48"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="48">        <span class="hljs-keyword">if</span> (fa[a][k] != fa[b][k])</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="49"><div class="hljs-ln-n" data-line-number="49"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="49">        {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="50"><div class="hljs-ln-n" data-line-number="50"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="50">            a = fa[a][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="51"><div class="hljs-ln-n" data-line-number="51"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="51">            b = fa[b][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="52"><div class="hljs-ln-n" data-line-number="52"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="52">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="53"><div class="hljs-ln-n" data-line-number="53"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="53">    <span class="hljs-keyword">return</span> fa[a][<span class="hljs-number">0</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="54"><div class="hljs-ln-n" data-line-number="54"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="54">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="55"><div class="hljs-ln-n" data-line-number="55"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="55"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="56"><div class="hljs-ln-n" data-line-number="56"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="56">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="57"><div class="hljs-ln-n" data-line-number="57"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="57">    <span class="hljs-built_in">memset</span>(head,<span class="hljs-number">-1</span>,<span class="hljs-keyword">sizeof</span> head);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="58"><div class="hljs-ln-n" data-line-number="58"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="58">    <span class="hljs-type">int</span> n;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="59"><div class="hljs-ln-n" data-line-number="59"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="59">    cin&gt;&gt;n;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="60"><div class="hljs-ln-n" data-line-number="60"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="60">    <span class="hljs-type">int</span> a,b,root=<span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="61"><div class="hljs-ln-n" data-line-number="61"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="61">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="62"><div class="hljs-ln-n" data-line-number="62"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="62">        cin&gt;&gt;a&gt;&gt;b;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="63"><div class="hljs-ln-n" data-line-number="63"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="63">        <span class="hljs-keyword">if</span>(b==<span class="hljs-number">-1</span>)root=a;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="64"><div class="hljs-ln-n" data-line-number="64"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="64">        <span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(a,b),<span class="hljs-built_in">add</span>(b,a);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="65"><div class="hljs-ln-n" data-line-number="65"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="65">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="66"><div class="hljs-ln-n" data-line-number="66"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="66">    <span class="hljs-built_in">bfs</span>(root);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="67"><div class="hljs-ln-n" data-line-number="67"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="67">    <span class="hljs-type">int</span> m,x,y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="68"><div class="hljs-ln-n" data-line-number="68"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="68">    cin&gt;&gt;m;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="69"><div class="hljs-ln-n" data-line-number="69"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="69">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="70"><div class="hljs-ln-n" data-line-number="70"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="70">        cin&gt;&gt;x&gt;&gt;y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="71"><div class="hljs-ln-n" data-line-number="71"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="71">        <span class="hljs-type">int</span> ans=<span class="hljs-built_in">lca</span>(x,y);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="72"><div class="hljs-ln-n" data-line-number="72"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="72">        <span class="hljs-keyword">if</span>(ans==x)cout&lt;&lt;<span class="hljs-number">1</span>&lt;&lt;endl;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="73"><div class="hljs-ln-n" data-line-number="73"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="73">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(ans==y)cout&lt;&lt;<span class="hljs-number">2</span>&lt;&lt;endl;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="74"><div class="hljs-ln-n" data-line-number="74"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="74">        <span class="hljs-keyword">else</span> cout&lt;&lt;<span class="hljs-number">0</span>&lt;&lt;endl;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="75"><div class="hljs-ln-n" data-line-number="75"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="75">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="76"><div class="hljs-ln-n" data-line-number="76"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="76">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="77"><div class="hljs-ln-n" data-line-number="77"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="77">}</td></tr></tbody></table></code><a class="copy-code" href="javascript:" data-clipboard-target="#code-block-0" title="拷贝代码"><i class="fa fa-clipboard" aria-hidden="true"></i></a></pre>
                <h2 id="Tarjan%EF%BC%88%E7%A6%BB%E7%BA%BF%EF%BC%89">Tarjan（离线）</h2>
                <p>需要注意的是这里的Tarjan算法是指离线求LCA的一种做法，而不是著名的求强连通分量的那个Tarjan。<br>
                  时间复杂度<span class="katex math inline">O(n+m)</span>,需要存下所有询问。至于和倍增写法的适用差别尚不明确，时间复杂度其实差的也不多？不过听说常数小一点。<br>
                  Tarjan是基于dfs的算法，在搜索过程中把点分为三类：未遍历过的点0，正在遍历的点1，已经遍历且回溯的点2。<br>
                  任选一点u开始搜索。<br>
                  对于与u相连且未搜索的点，递归搜索它并标记为1，回溯时使用并查集将其全部合并到当前点。其实在树中，深度比u深的且和u相连的点就是u的儿子，所以是把儿子都合并到父亲上。<br>
                  然后处理与当前点有关的询问，如果另一个点有标记2，那么当前点与另一个点的LCA就是另一个点的根节点。（其实就是这两个子树中节点的LCA都是那个点）<br>
                  最后把这个根节点标记为2。<br>
                  为什么标记2的点的根节点就是LCA？因为标记为2的点已经被合并完毕，它在并查集中的fa不会有变化了，这个fa也就是它所在的子树的根节点。（其实又利用了LCA合并子树的性质，我觉得）而这个根节点是LCA与dfs的遍历顺序有关，标记为2的点一定是先被遍历，而标记为1的则是之后才被遍历。因为在回溯的时候才会把路径压缩到根节点，所以会保证标记2的点的fa是LCA，即是两个查询节点所在子树的根节点。</p>
                <pre class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" design="by Mashiro"><code class="language-cpp hljs" data-rel="CPP" id="code-block-1"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">using</span> PII=pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt;;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-type">const</span> <span class="hljs-type">int</span> maxn=<span class="hljs-number">2e4</span>+<span class="hljs-number">10</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-type">int</span> head[maxn],tot,n,m;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-type">int</span> dis[maxn];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-type">int</span> fa[maxn];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-type">int</span> st[maxn],res[maxn];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">    <span class="hljs-type">int</span> to,w,next;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">}eg[maxn&lt;&lt;<span class="hljs-number">1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">vector&lt;PII&gt; query[maxn];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> w)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">    eg[tot].to=v;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">    eg[tot].w=w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19">    eg[tot].next=head[u];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">    head[u]=tot++;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> fath)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];~i;i=eg[i].next)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">        <span class="hljs-type">int</span> j=eg[i].to;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27">        <span class="hljs-keyword">if</span>(j==fath)<span class="hljs-keyword">continue</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">        dis[j]=dis[u]+eg[i].w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29">        <span class="hljs-built_in">dfs</span>(j,u);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34">    <span class="hljs-keyword">return</span> x==fa[x]?x:fa[x]=<span class="hljs-built_in">find</span>(fa[x]);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">tarjan</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="37"><div class="hljs-ln-n" data-line-number="37"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="37">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="38"><div class="hljs-ln-n" data-line-number="38"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="38">    st[u]=<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="39"><div class="hljs-ln-n" data-line-number="39"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="39">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];~i;i=eg[i].next)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="40"><div class="hljs-ln-n" data-line-number="40"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="40">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="41"><div class="hljs-ln-n" data-line-number="41"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="41">        <span class="hljs-type">int</span> j=eg[i].to;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="42"><div class="hljs-ln-n" data-line-number="42"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="42">        <span class="hljs-keyword">if</span>(!st[j]){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="43"><div class="hljs-ln-n" data-line-number="43"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="43">            <span class="hljs-built_in">tarjan</span>(j);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="44"><div class="hljs-ln-n" data-line-number="44"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="44">            fa[j]=u;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="45"><div class="hljs-ln-n" data-line-number="45"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="45">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="46"><div class="hljs-ln-n" data-line-number="46"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="46">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="47"><div class="hljs-ln-n" data-line-number="47"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="47">    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> item:query[u])</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="48"><div class="hljs-ln-n" data-line-number="48"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="48">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="49"><div class="hljs-ln-n" data-line-number="49"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="49">        <span class="hljs-type">int</span> y=item.first,id=item.second;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="50"><div class="hljs-ln-n" data-line-number="50"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="50">        <span class="hljs-keyword">if</span>(st[y]==<span class="hljs-number">2</span>){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="51"><div class="hljs-ln-n" data-line-number="51"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="51">            <span class="hljs-type">int</span> anc=<span class="hljs-built_in">find</span>(y);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="52"><div class="hljs-ln-n" data-line-number="52"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="52">            res[id]=dis[u]+dis[y]<span class="hljs-number">-2</span>*dis[anc];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="53"><div class="hljs-ln-n" data-line-number="53"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="53">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="54"><div class="hljs-ln-n" data-line-number="54"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="54">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="55"><div class="hljs-ln-n" data-line-number="55"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="55">    st[u]=<span class="hljs-number">2</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="56"><div class="hljs-ln-n" data-line-number="56"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="56">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="57"><div class="hljs-ln-n" data-line-number="57"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="57"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="58"><div class="hljs-ln-n" data-line-number="58"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="58">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="59"><div class="hljs-ln-n" data-line-number="59"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="59">    <span class="hljs-built_in">memset</span>(head,<span class="hljs-number">-1</span>,<span class="hljs-keyword">sizeof</span> head);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="60"><div class="hljs-ln-n" data-line-number="60"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="60">    cin&gt;&gt;n&gt;&gt;m;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="61"><div class="hljs-ln-n" data-line-number="61"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="61">    <span class="hljs-type">int</span> u,v,w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="62"><div class="hljs-ln-n" data-line-number="62"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="62">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="63"><div class="hljs-ln-n" data-line-number="63"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="63">        cin&gt;&gt;u&gt;&gt;v&gt;&gt;w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="64"><div class="hljs-ln-n" data-line-number="64"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="64">        <span class="hljs-built_in">add</span>(u,v,w),<span class="hljs-built_in">add</span>(v,u,w);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="65"><div class="hljs-ln-n" data-line-number="65"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="65">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="66"><div class="hljs-ln-n" data-line-number="66"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="66">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;i++){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="67"><div class="hljs-ln-n" data-line-number="67"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="67">        cin&gt;&gt;u&gt;&gt;v;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="68"><div class="hljs-ln-n" data-line-number="68"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="68">        <span class="hljs-keyword">if</span>(u!=v){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="69"><div class="hljs-ln-n" data-line-number="69"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="69">            query[u].<span class="hljs-built_in">push_back</span>({v,i});</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="70"><div class="hljs-ln-n" data-line-number="70"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="70">            query[v].<span class="hljs-built_in">push_back</span>({u,i});</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="71"><div class="hljs-ln-n" data-line-number="71"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="71">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="72"><div class="hljs-ln-n" data-line-number="72"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="72">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="73"><div class="hljs-ln-n" data-line-number="73"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="73">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)fa[i]=i;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="74"><div class="hljs-ln-n" data-line-number="74"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="74">    <span class="hljs-built_in">dfs</span>(<span class="hljs-number">2</span>,<span class="hljs-number">-1</span>);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="75"><div class="hljs-ln-n" data-line-number="75"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="75">    <span class="hljs-built_in">tarjan</span>(<span class="hljs-number">2</span>);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="76"><div class="hljs-ln-n" data-line-number="76"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="76">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;i++)cout&lt;&lt;res[i]&lt;&lt;endl;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="77"><div class="hljs-ln-n" data-line-number="77"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="77">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="78"><div class="hljs-ln-n" data-line-number="78"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="78">}</td></tr></tbody></table></code><a class="copy-code" href="javascript:" data-clipboard-target="#code-block-1" title="拷贝代码"><i class="fa fa-clipboard" aria-hidden="true"></i></a></pre>
                <h2 id="%E5%BA%94%E7%94%A8">应用</h2>
                <h3 id="%E6%AC%A1%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91">次小生成树</h3>
                <p>这是人做的？</p>
                <pre class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" design="by Mashiro"><code class="language-cpp hljs" data-rel="CPP" id="code-block-2"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">using</span> ll=<span class="hljs-type">long</span> <span class="hljs-type">long</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span>+<span class="hljs-number">10</span>,M=<span class="hljs-number">3e5</span>+<span class="hljs-number">10</span>,inf=<span class="hljs-number">0x3f3f3f3f</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-type">int</span> n,m;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">    <span class="hljs-type">int</span> a,b,w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">    <span class="hljs-type">bool</span> used;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">}eg[M];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14"><span class="hljs-type">int</span> p[N];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15"><span class="hljs-type">int</span> h[N],e[M],w[M],ne[M],idx;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"><span class="hljs-type">int</span> depth[N],fa[N][<span class="hljs-number">17</span>],d1[N][<span class="hljs-number">17</span>],d2[N][<span class="hljs-number">17</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b,<span class="hljs-type">int</span> c)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19">    e[idx]=b,ne[idx]=h[a],w[idx]=c,h[a]=idx++;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">    <span class="hljs-keyword">return</span> x==p[x]?x:p[x]=<span class="hljs-built_in">find</span>(p[x]);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25"><span class="hljs-function">ll <span class="hljs-title">kruskal</span><span class="hljs-params">()</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)p[i]=i;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">    <span class="hljs-built_in">sort</span>(eg,eg+m,[](edge a,edge b){<span class="hljs-keyword">return</span> a.w&lt;b.w;});</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29">    ll res=<span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;i++)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32">        <span class="hljs-type">int</span> a=<span class="hljs-built_in">find</span>(eg[i].a),b=<span class="hljs-built_in">find</span>(eg[i].b);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33">        <span class="hljs-keyword">if</span>(a!=b){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34">            p[a]=b;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35">            res+=eg[i].w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36">            eg[i].used=<span class="hljs-literal">true</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="37"><div class="hljs-ln-n" data-line-number="37"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="37">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="38"><div class="hljs-ln-n" data-line-number="38"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="38">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="39"><div class="hljs-ln-n" data-line-number="39"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="39">    <span class="hljs-keyword">return</span> res;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="40"><div class="hljs-ln-n" data-line-number="40"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="40">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="41"><div class="hljs-ln-n" data-line-number="41"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="41"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="42"><div class="hljs-ln-n" data-line-number="42"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="42">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="43"><div class="hljs-ln-n" data-line-number="43"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="43">    <span class="hljs-built_in">memset</span>(h,<span class="hljs-number">-1</span>,<span class="hljs-keyword">sizeof</span> h);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="44"><div class="hljs-ln-n" data-line-number="44"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="44">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;i++)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="45"><div class="hljs-ln-n" data-line-number="45"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="45">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="46"><div class="hljs-ln-n" data-line-number="46"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="46">        <span class="hljs-keyword">if</span>(eg[i].used)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="47"><div class="hljs-ln-n" data-line-number="47"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="47">        {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="48"><div class="hljs-ln-n" data-line-number="48"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="48">            <span class="hljs-type">int</span> a=eg[i].a,b=eg[i].b,w=eg[i].w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="49"><div class="hljs-ln-n" data-line-number="49"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="49">            <span class="hljs-built_in">add</span>(a,b,w),<span class="hljs-built_in">add</span>(b,a,w);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="50"><div class="hljs-ln-n" data-line-number="50"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="50">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="51"><div class="hljs-ln-n" data-line-number="51"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="51">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="52"><div class="hljs-ln-n" data-line-number="52"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="52">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="53"><div class="hljs-ln-n" data-line-number="53"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="53"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="54"><div class="hljs-ln-n" data-line-number="54"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="54">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="55"><div class="hljs-ln-n" data-line-number="55"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="55">    <span class="hljs-built_in">memset</span>(depth,inf,<span class="hljs-keyword">sizeof</span> depth);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="56"><div class="hljs-ln-n" data-line-number="56"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="56">    depth[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>,depth[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="57"><div class="hljs-ln-n" data-line-number="57"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="57">    queue&lt;<span class="hljs-type">int</span>&gt;q;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="58"><div class="hljs-ln-n" data-line-number="58"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="58">    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="59"><div class="hljs-ln-n" data-line-number="59"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="59">    <span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>())</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="60"><div class="hljs-ln-n" data-line-number="60"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="60">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="61"><div class="hljs-ln-n" data-line-number="61"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="61">        <span class="hljs-type">int</span> t=q.<span class="hljs-built_in">front</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="62"><div class="hljs-ln-n" data-line-number="62"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="62">        q.<span class="hljs-built_in">pop</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="63"><div class="hljs-ln-n" data-line-number="63"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="63">        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=h[t];~i;i=ne[i])</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="64"><div class="hljs-ln-n" data-line-number="64"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="64">        {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="65"><div class="hljs-ln-n" data-line-number="65"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="65">            <span class="hljs-type">int</span> j=e[i];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="66"><div class="hljs-ln-n" data-line-number="66"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="66">            <span class="hljs-keyword">if</span>(depth[j]&gt;depth[t]+<span class="hljs-number">1</span>){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="67"><div class="hljs-ln-n" data-line-number="67"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="67">                depth[j]=depth[t]+<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="68"><div class="hljs-ln-n" data-line-number="68"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="68">                q.<span class="hljs-built_in">push</span>(j);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="69"><div class="hljs-ln-n" data-line-number="69"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="69">                fa[j][<span class="hljs-number">0</span>]=t;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="70"><div class="hljs-ln-n" data-line-number="70"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="70">                d1[j][<span class="hljs-number">0</span>]=w[i],d2[j][<span class="hljs-number">0</span>]=-inf;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="71"><div class="hljs-ln-n" data-line-number="71"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="71">                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>;k&lt;=<span class="hljs-number">16</span>;k++)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="72"><div class="hljs-ln-n" data-line-number="72"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="72">                {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="73"><div class="hljs-ln-n" data-line-number="73"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="73">                    <span class="hljs-type">int</span> anc=fa[j][k<span class="hljs-number">-1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="74"><div class="hljs-ln-n" data-line-number="74"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="74">                    fa[j][k]=fa[anc][k<span class="hljs-number">-1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="75"><div class="hljs-ln-n" data-line-number="75"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="75">                    <span class="hljs-type">int</span> distance[<span class="hljs-number">4</span>]={d1[j][k<span class="hljs-number">-1</span>],d2[j][k<span class="hljs-number">-1</span>],d1[anc][k<span class="hljs-number">-1</span>],d2[anc][k<span class="hljs-number">-1</span>]};</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="76"><div class="hljs-ln-n" data-line-number="76"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="76">                    d1[j][k]=d2[j][k]=-inf;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="77"><div class="hljs-ln-n" data-line-number="77"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="77">                    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> d:distance)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="78"><div class="hljs-ln-n" data-line-number="78"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="78">                    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="79"><div class="hljs-ln-n" data-line-number="79"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="79">                        <span class="hljs-keyword">if</span>(d&gt;d1[j][k])d2[j][k]=d1[j][k],d1[j][k]=d;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="80"><div class="hljs-ln-n" data-line-number="80"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="80">                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(d!=d1[j][k]&amp;&amp;d&gt;d2[j][k])d2[j][k]=d;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="81"><div class="hljs-ln-n" data-line-number="81"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="81">                    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="82"><div class="hljs-ln-n" data-line-number="82"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="82">                }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="83"><div class="hljs-ln-n" data-line-number="83"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="83">            }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="84"><div class="hljs-ln-n" data-line-number="84"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="84">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="85"><div class="hljs-ln-n" data-line-number="85"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="85">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="86"><div class="hljs-ln-n" data-line-number="86"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="86">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="87"><div class="hljs-ln-n" data-line-number="87"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="87"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lca</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b,<span class="hljs-type">int</span> w)</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="88"><div class="hljs-ln-n" data-line-number="88"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="88">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="89"><div class="hljs-ln-n" data-line-number="89"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="89">    <span class="hljs-type">static</span> <span class="hljs-type">int</span> distance[N&lt;&lt;<span class="hljs-number">1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="90"><div class="hljs-ln-n" data-line-number="90"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="90">    <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="91"><div class="hljs-ln-n" data-line-number="91"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="91">    <span class="hljs-keyword">if</span>(depth[a]&lt;depth[b])<span class="hljs-built_in">swap</span>(a,b);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="92"><div class="hljs-ln-n" data-line-number="92"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="92">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">16</span>;k&gt;=<span class="hljs-number">0</span>;k--)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="93"><div class="hljs-ln-n" data-line-number="93"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="93">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="94"><div class="hljs-ln-n" data-line-number="94"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="94">        <span class="hljs-keyword">if</span>(depth[fa[a][k]]&gt;=depth[b])</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="95"><div class="hljs-ln-n" data-line-number="95"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="95">        {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="96"><div class="hljs-ln-n" data-line-number="96"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="96">            distance[cnt++]=d1[a][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="97"><div class="hljs-ln-n" data-line-number="97"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="97">            distance[cnt++]=d2[a][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="98"><div class="hljs-ln-n" data-line-number="98"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="98">            a=fa[a][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="99"><div class="hljs-ln-n" data-line-number="99"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="99">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="100"><div class="hljs-ln-n" data-line-number="100"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="100">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="101"><div class="hljs-ln-n" data-line-number="101"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="101">    <span class="hljs-keyword">if</span>(a!=b)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="102"><div class="hljs-ln-n" data-line-number="102"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="102">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="103"><div class="hljs-ln-n" data-line-number="103"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="103">        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">16</span>;k&gt;=<span class="hljs-number">0</span>;k--)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="104"><div class="hljs-ln-n" data-line-number="104"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="104">        {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="105"><div class="hljs-ln-n" data-line-number="105"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="105">            <span class="hljs-keyword">if</span>(fa[a][k]!=fa[b][k])</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="106"><div class="hljs-ln-n" data-line-number="106"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="106">            {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="107"><div class="hljs-ln-n" data-line-number="107"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="107">                distance[cnt++]=d1[a][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="108"><div class="hljs-ln-n" data-line-number="108"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="108">                distance[cnt++]=d2[a][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="109"><div class="hljs-ln-n" data-line-number="109"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="109">                distance[cnt++]=d1[b][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="110"><div class="hljs-ln-n" data-line-number="110"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="110">                distance[cnt++]=d2[b][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="111"><div class="hljs-ln-n" data-line-number="111"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="111">                a=fa[a][k],b=fa[b][k];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="112"><div class="hljs-ln-n" data-line-number="112"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="112">            }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="113"><div class="hljs-ln-n" data-line-number="113"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="113">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="114"><div class="hljs-ln-n" data-line-number="114"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="114">        distance[cnt++]=d1[a][<span class="hljs-number">0</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="115"><div class="hljs-ln-n" data-line-number="115"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="115">        distance[cnt++]=d1[b][<span class="hljs-number">0</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="116"><div class="hljs-ln-n" data-line-number="116"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="116">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="117"><div class="hljs-ln-n" data-line-number="117"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="117">    <span class="hljs-type">int</span> dis1=-inf,dis2=-inf;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="118"><div class="hljs-ln-n" data-line-number="118"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="118">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;cnt;i++)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="119"><div class="hljs-ln-n" data-line-number="119"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="119">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="120"><div class="hljs-ln-n" data-line-number="120"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="120">        <span class="hljs-type">int</span> d=distance[i];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="121"><div class="hljs-ln-n" data-line-number="121"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="121">        <span class="hljs-keyword">if</span>(d&gt;dis1)dis2=dis1,dis1=d;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="122"><div class="hljs-ln-n" data-line-number="122"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="122">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(d!=dis1&amp;&amp;d&gt;dis2)dis2=d;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="123"><div class="hljs-ln-n" data-line-number="123"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="123">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="124"><div class="hljs-ln-n" data-line-number="124"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="124">    <span class="hljs-keyword">if</span>(w&gt;dis1)<span class="hljs-keyword">return</span> w-dis1;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="125"><div class="hljs-ln-n" data-line-number="125"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="125">    <span class="hljs-keyword">if</span>(w&gt;dis2)<span class="hljs-keyword">return</span> w-dis2;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="126"><div class="hljs-ln-n" data-line-number="126"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="126">    <span class="hljs-keyword">return</span> inf;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="127"><div class="hljs-ln-n" data-line-number="127"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="127">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="128"><div class="hljs-ln-n" data-line-number="128"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="128"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="129"><div class="hljs-ln-n" data-line-number="129"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="129">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="130"><div class="hljs-ln-n" data-line-number="130"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="130">    cin&gt;&gt;n&gt;&gt;m;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="131"><div class="hljs-ln-n" data-line-number="131"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="131">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;i++){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="132"><div class="hljs-ln-n" data-line-number="132"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="132">        <span class="hljs-type">int</span> a,b,c;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="133"><div class="hljs-ln-n" data-line-number="133"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="133">        cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="134"><div class="hljs-ln-n" data-line-number="134"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="134">        eg[i]={a,b,c};</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="135"><div class="hljs-ln-n" data-line-number="135"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="135">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="136"><div class="hljs-ln-n" data-line-number="136"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="136">    ll sum=<span class="hljs-built_in">kruskal</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="137"><div class="hljs-ln-n" data-line-number="137"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="137">    <span class="hljs-built_in">build</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="138"><div class="hljs-ln-n" data-line-number="138"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="138">    <span class="hljs-built_in">bfs</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="139"><div class="hljs-ln-n" data-line-number="139"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="139">    ll res=<span class="hljs-number">2e18</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="140"><div class="hljs-ln-n" data-line-number="140"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="140">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;m;i++)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="141"><div class="hljs-ln-n" data-line-number="141"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="141">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="142"><div class="hljs-ln-n" data-line-number="142"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="142">        <span class="hljs-keyword">if</span>(!eg[i].used)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="143"><div class="hljs-ln-n" data-line-number="143"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="143">        {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="144"><div class="hljs-ln-n" data-line-number="144"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="144">            <span class="hljs-type">int</span> a=eg[i].a,b=eg[i].b,w=eg[i].w;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="145"><div class="hljs-ln-n" data-line-number="145"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="145">            res=<span class="hljs-built_in">min</span>(res,sum+<span class="hljs-built_in">lca</span>(a,b,w));</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="146"><div class="hljs-ln-n" data-line-number="146"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="146">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="147"><div class="hljs-ln-n" data-line-number="147"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="147">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="148"><div class="hljs-ln-n" data-line-number="148"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="148">    cout&lt;&lt;res&lt;&lt;endl;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="149"><div class="hljs-ln-n" data-line-number="149"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="149">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="150"><div class="hljs-ln-n" data-line-number="150"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="150">}</td></tr></tbody></table></code><a class="copy-code" href="javascript:" data-clipboard-target="#code-block-2" title="拷贝代码"><i class="fa fa-clipboard" aria-hidden="true"></i></a></pre>
                <p>除了LCA和最小生成树不用说，主要的问题在于存路径上的最长边和次长边用于之后的替换。</p>
                <h3 id="%E6%A0%91%E4%B8%8A%E5%B7%AE%E5%88%86">树上差分</h3>
                <pre class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" design="by Mashiro"><code class="language-cpp hljs" data-rel="CPP" id="code-block-3"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 500100</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-type">int</span> n,m,tot,ans,p[N],f1[N],lin[N],f[N][<span class="hljs-number">25</span>],d[N],vis[N];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">gg</span> {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    <span class="hljs-type">int</span> x,y,next;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">}a[N&lt;&lt;<span class="hljs-number">1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span> </span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">    a[++tot].x=x;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">    a[tot].y=y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">    a[tot].next=lin[x];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">    lin[x]=tot;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">    queue&lt;<span class="hljs-type">int</span>&gt; q;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16">    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">    d[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>()) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19">        <span class="hljs-type">int</span> x=q.<span class="hljs-built_in">front</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">        q.<span class="hljs-built_in">pop</span>();</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=lin[x];i;i=a[i].next) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">            <span class="hljs-type">int</span> y=a[i].y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">            <span class="hljs-keyword">if</span>(d[y]) <span class="hljs-keyword">continue</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">            d[y]=d[x]+<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">            f[y][<span class="hljs-number">0</span>]=x;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=<span class="hljs-number">23</span>;j++){</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27">                f[y][j]=f[f[y][j<span class="hljs-number">-1</span>]][j<span class="hljs-number">-1</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">            }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29">            q.<span class="hljs-built_in">push</span>(y);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">lca</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span> </span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34">    <span class="hljs-keyword">if</span>(d[x]&gt;d[y]) <span class="hljs-built_in">swap</span>(x,y);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">23</span>;i&gt;=<span class="hljs-number">0</span>;i--) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36">        <span class="hljs-keyword">if</span>(d[f[y][i]]&gt;=d[x]) y=f[y][i];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="37"><div class="hljs-ln-n" data-line-number="37"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="37">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="38"><div class="hljs-ln-n" data-line-number="38"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="38">    <span class="hljs-keyword">if</span>(x==y) <span class="hljs-keyword">return</span> x;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="39"><div class="hljs-ln-n" data-line-number="39"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="39">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">23</span>;i&gt;=<span class="hljs-number">0</span>;i--) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="40"><div class="hljs-ln-n" data-line-number="40"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="40">        <span class="hljs-keyword">if</span>(f[x][i]!=f[y][i]) x=f[x][i],y=f[y][i];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="41"><div class="hljs-ln-n" data-line-number="41"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="41">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="42"><div class="hljs-ln-n" data-line-number="42"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="42">    <span class="hljs-keyword">return</span> f[x][<span class="hljs-number">0</span>];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="43"><div class="hljs-ln-n" data-line-number="43"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="43">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="44"><div class="hljs-ln-n" data-line-number="44"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="44"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="45"><div class="hljs-ln-n" data-line-number="45"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="45">    vis[x]=<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="46"><div class="hljs-ln-n" data-line-number="46"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="46">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=lin[x];i;i=a[i].next) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="47"><div class="hljs-ln-n" data-line-number="47"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="47">        <span class="hljs-type">int</span> y=a[i].y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="48"><div class="hljs-ln-n" data-line-number="48"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="48">        <span class="hljs-keyword">if</span>(vis[y]) <span class="hljs-keyword">continue</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="49"><div class="hljs-ln-n" data-line-number="49"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="49">        <span class="hljs-built_in">dfs</span>(y);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="50"><div class="hljs-ln-n" data-line-number="50"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="50">        p[x]+=p[y];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="51"><div class="hljs-ln-n" data-line-number="51"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="51">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="52"><div class="hljs-ln-n" data-line-number="52"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="52">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="53"><div class="hljs-ln-n" data-line-number="53"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="53"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="54"><div class="hljs-ln-n" data-line-number="54"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="54">    cin&gt;&gt;n&gt;&gt;m;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="55"><div class="hljs-ln-n" data-line-number="55"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="55">    <span class="hljs-type">int</span> x,y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="56"><div class="hljs-ln-n" data-line-number="56"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="56">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="57"><div class="hljs-ln-n" data-line-number="57"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="57">        cin&gt;&gt;x&gt;&gt;y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="58"><div class="hljs-ln-n" data-line-number="58"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="58">        <span class="hljs-built_in">add</span>(x,y);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="59"><div class="hljs-ln-n" data-line-number="59"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="59">        <span class="hljs-built_in">add</span>(y,x);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="60"><div class="hljs-ln-n" data-line-number="60"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="60">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="61"><div class="hljs-ln-n" data-line-number="61"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="61">    <span class="hljs-built_in">bfs</span>(<span class="hljs-number">1</span>);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="62"><div class="hljs-ln-n" data-line-number="62"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="62">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="63"><div class="hljs-ln-n" data-line-number="63"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="63">        cin&gt;&gt;x&gt;&gt;y;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="64"><div class="hljs-ln-n" data-line-number="64"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="64">        p[x]++,p[y]++;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="65"><div class="hljs-ln-n" data-line-number="65"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="65">        p[<span class="hljs-built_in">lca</span>(x,y)]-=<span class="hljs-number">2</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="66"><div class="hljs-ln-n" data-line-number="66"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="66">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="67"><div class="hljs-ln-n" data-line-number="67"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="67">    <span class="hljs-built_in">dfs</span>(<span class="hljs-number">1</span>);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="68"><div class="hljs-ln-n" data-line-number="68"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="68">    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="69"><div class="hljs-ln-n" data-line-number="69"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="69">        <span class="hljs-keyword">if</span>(!p[i]) ans+=m;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="70"><div class="hljs-ln-n" data-line-number="70"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="70">        <span class="hljs-keyword">if</span>(p[i]==<span class="hljs-number">1</span>) ans+=<span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="71"><div class="hljs-ln-n" data-line-number="71"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="71">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="72"><div class="hljs-ln-n" data-line-number="72"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="72">    cout&lt;&lt;ans&lt;&lt;endl;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="73"><div class="hljs-ln-n" data-line-number="73"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="73">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="74"><div class="hljs-ln-n" data-line-number="74"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="74">}</td></tr></tbody></table></code><a class="copy-code" href="javascript:" data-clipboard-target="#code-block-3" title="拷贝代码"><i class="fa fa-clipboard" aria-hidden="true"></i></a></pre>
                <h2 id="%E6%80%BB%E7%BB%93">总结</h2>
                <p>LCA算是偏基础的算法了，不是说他好写，是需要用它作为其它算法的基础才能解决问题。裸的LCA没啥问题，但是用LCA去解决在树上找边、删边、换边等问题就比较麻烦了。</p>
                <!--<div class="oshimai"></div>-->
                <!--<h2 style="opacity:0;max-height:0;margin:0">Comments</h2>--><!-- 评论跳转标记 -->
              </div>
            </article>
          </main>
        </div>
      </div>
    </article>
  </div>
  <FooterBar/>
</template>

<script>
import PatternCenter from "@/components/Header/PatternCenter";
import NavigationBar from "@/components/Header/NavigationBar";
import FooterBar from "@/components/Footer/footerBar";
export default {
  name: "AboutPage",
  components:{
    FooterBar,
    NavigationBar,
    PatternCenter,
  }
}
</script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  scroll-behavior: smooth;
  font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Source Han Serif', source-han-serif-sc, 'PT Serif', 'SongTi SC', 'MicroSoft Yahei', Georgia, serif;
}
.article-container p{
  display: inline-block;
  line-height: 2rem;
  margin:0 0 25px 0;
}
a{
  color: #409EFF;
  text-decoration: none;
}
h1{
  color: rgba(73,146,188,0.83);
  font-size: 2rem;
  line-height: 4rem;
}
h2{
  color: rgba(73,146,188,0.83);
  font-size: 1.5rem;
  line-height: 4rem;
}
h3{
  color: rgba(73,146,188,0.83);
  font-size: 1.5rem;
  line-height: 4rem;
}
p{
  max-width: 100vw;
}
.entry-content-box {
  max-width: 860px;
  padding: 0 20px;
  margin: 0 auto;
}

.site-main {
  padding: 4.5% 0 0;
}
</style>